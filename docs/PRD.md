# PRD - 微信视频号 AI 弹幕助手（离线优先 MVP）

## 目标
在视频号直播中，像真人观众一样进行自然互动：实时观察弹幕/语境、生成恰当文案、半自动/自动发送，并将文本与音频归档，便于复盘。

## 用户与场景
- 运营人员：需要低风险辅助活跃气氛，半自动审核后发送。
- 开发测试：在离线环境验证端到端链路与可靠性，优先快速跑通。

## 范围（MVP）
- 登录与观看：人工在 Safari 登录并打开直播页。
- 弹幕监听：页面轮询/注入脚本抓取最新弹幕（选择器可配置）。
- 文案生成：本地 LLM（Ollama 优先）→ 无可用时使用模板回退。
- 发送：
  - 半自动：终端审核 → 自动复制粘贴 + 回车（或 DOM 发送）。
  - 自动（可选）：DOM 发送（需配置选择器和频控）。
- TTS：使用 macOS `say` 生成音频，归档到 `data/tts/`。
- 存储：SQLite 存储弹幕、生成结果、发送日志、音频路径。
- ASR：接口预留（未来接入 BlackHole + sherpa-onnx）。

## 非目标
- 逆向/私有接口直接发送；
- 复杂风控策略（仅提供基础节流与随机化接口）。

## 验收标准
- 打开直播页后：
  1) 能抓取弹幕并入库（含时间戳与来源）。
  2) 能周期性生成候选互动文案（含上下文拼接）。
  3) 半自动模式：终端确认后成功发送到弹幕输入框。
  4) 为每条生成文案生成一份音频文件并记录路径。
  5) 断网情况下（除直播观看）功能可运行：生成、TTS、存储均不依赖外网。

## 风险与约束
- DOM 结构变更：通过可配置选择器与回退路径（粘贴发送）降低耦合。
- 风控：默认仅半自动；自动模式时需开启节流与随机化。
- 音频采集：MVP 使用占位/样本；真流式 ASR 在下一阶段。

## 里程碑
1. P0：半自动发送 + TTS 归档 + SQLite（本提交）
2. P1：ASR 接入（BlackHole + sherpa-onnx）
3. P2：自动模式（频控、人类化输入、失败截图与重试）

